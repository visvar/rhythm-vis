const g=Symbol,Ie=", ",l=(()=>{const r="front",t="side",s="rear",n="left",e="center",i="right";return["",r+" ",t+" ",s+" "].map(c=>[[n,i],[n,i,e],[n,e,i],[e,n,i],[e]].flatMap(a=>a.map(f=>c+f).join(Ie)))})(),q="LFE",O0="monophonic (mono)",f0="stereo",M0="surround",F=(r,...t)=>`${[O0,f0,`linear ${M0}`,"quadraphonic",`5.0 ${M0}`,`5.1 ${M0}`,`6.1 ${M0}`,`7.1 ${M0}`][r-1]} (${t.join(Ie)})`,se=[O0,F(2,l[0][0]),F(3,l[0][2]),F(4,l[1][0],l[3][0]),F(5,l[1][2],l[3][0]),F(6,l[1][2],l[3][0],q),F(7,l[1][2],l[2][0],l[3][4],q),F(8,l[1][2],l[2][0],l[3][0],q)],ts=192e3,es=176400,Ue=96e3,Ae=88200,ss=64e3,mt=48e3,oe=44100,ce=32e3,ae=24e3,le=22050,he=16e3,Ne=12e3,De=11025,ue=8e3,ns=7350,_0="absoluteGranulePosition",d="bandwidth",j="bitDepth",A="bitrate",Pt=A+"Maximum",Ht=A+"Minimum",Lt=A+"Nominal",T0="buffer",It=T0+"Fullness",k="codec",W=k+"Frames",nt="coupledStreamCount",pt="crc",Re=pt+"16",Oe=pt+"32",v="data",h="description",d0="duration",G0="emphasis",Ut="hasOpusPadding",n0="header",L0="isContinuedPacket",At="isCopyrighted",I0="isFirstPage",Nt="isHome",i0="isLastPage",m0="isOriginal",g0="isPrivate",Dt="isVbr",N="layer",o="length",b="mode",t0=b+"Extension",Te="mpeg",y0=Te+"Version",Rt="numberAACFrames",Ot="outputGain",it="preSkip",Tt="profile",Et=g(),C0="protection",is="rawData",e0="segments",y="subarray",U0="version",gt="vorbis",rt=gt+"Comments",ot=gt+"Setup",yt="block",zt=yt+"ingStrategy",Vt=g(),X=yt+"Size",$0=yt+"size0",P0=yt+"size1",j0=g(),Ct="channel",Q=Ct+"MappingFamily",ct=Ct+"MappingTable",J=Ct+"Mode",W0=g(),u=Ct+"s",Ee="copyright",qt=Ee+"Id",Gt=Ee+"IdStart",o0="frame",p0=o0+"Count",Z=o0+"Length",St="Number",A0=o0+St,E=o0+"Padding",p=o0+"Size",ze="Rate",jt="inputSample"+ze,be="page",at=be+"Checksum",dt=g(),H0=be+"SegmentTable",H=be+"Sequence"+St,pe="sample",Wt=pe+St,w=pe+ze,z=g(),M=pe+"s",xt="stream",lt=xt+"Count",Ve=xt+"Info",S0=xt+"Serial"+St,rs=xt+"StructureVersion",de="total",ht=de+"BytesOut",ut=de+"Duration",ne=de+"Samples",x=g(),G=g(),Jt=g(),wt=g(),x0=g(),qe=g(),we=g(),Ft=g(),$=g(),F0=g(),c0=g(),E0=g(),kt=g(),Ge=g(),r0=g(),w0=g(),k0=g(),je=g(),R=Uint8Array,vt=DataView,m="reserved",U="bad",B0="free",fe="none",We="16bit CRC",_e=(r,t,s)=>{for(let n=0;n<r[o];n++){let e=t(n);for(let i=8;i>0;i--)e=s(e);r[n]=e}return r},os=_e(new R(256),r=>r,r=>r&128?7^r<<1:r<<1),C=[_e(new Uint16Array(256),r=>r<<8,r=>r<<1^(r&32768?32773:0))],S=[_e(new Uint32Array(256),r=>r,r=>r>>>1^(r&1)*3988292384)];for(let r=0;r<15;r++){C.push(new Uint16Array(256)),S.push(new Uint32Array(256));for(let t=0;t<=255;t++)C[r+1][t]=C[0][C[r][t]>>>8]^C[r][t]<<8,S[r+1][t]=S[r][t]>>>8^S[0][S[r][t]&255]}const cs=r=>{let t=0;const s=r[o];for(let n=0;n!==s;n++)t=os[t^r[n]];return t},as=r=>{const t=r[o],s=t-16;let n=0,e=0;for(;e<=s;)n^=r[e++]<<8|r[e++],n=C[15][n>>8]^C[14][n&255]^C[13][r[e++]]^C[12][r[e++]]^C[11][r[e++]]^C[10][r[e++]]^C[9][r[e++]]^C[8][r[e++]]^C[7][r[e++]]^C[6][r[e++]]^C[5][r[e++]]^C[4][r[e++]]^C[3][r[e++]]^C[2][r[e++]]^C[1][r[e++]]^C[0][r[e++]];for(;e!==t;)n=(n&255)<<8^C[0][n>>8^r[e++]];return n},ls=r=>{const t=r[o],s=t-16;let n=0,e=0;for(;e<=s;)n=S[15][(r[e++]^n)&255]^S[14][(r[e++]^n>>>8)&255]^S[13][(r[e++]^n>>>16)&255]^S[12][r[e++]^n>>>24]^S[11][r[e++]]^S[10][r[e++]]^S[9][r[e++]]^S[8][r[e++]]^S[7][r[e++]]^S[6][r[e++]]^S[5][r[e++]]^S[4][r[e++]]^S[3][r[e++]]^S[2][r[e++]]^S[1][r[e++]]^S[0][r[e++]];for(;e!==t;)n=S[0][(n^r[e++])&255]^n>>>8;return n^-1},ie=(...r)=>{const t=new R(r.reduce((s,n)=>s+n[o],0));return r.reduce((s,n)=>(t.set(n,s),s+n[o]),0),t},a0=r=>String.fromCharCode(...r),Fe=[0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15],ft=r=>Fe[r&15]<<4|Fe[r>>4];class hs{constructor(t){this._data=t,this._pos=t[o]*8}set position(t){this._pos=t}get position(){return this._pos}read(t){const s=Math.floor(this._pos/8),n=this._pos%8;return this._pos-=t,(ft(this._data[s-1])<<8)+ft(this._data[s])>>7-n&255}}class us{constructor(t,s){this._onCodecHeader=t,this._onCodecUpdate=s,this[r0]()}[w0](){this._isEnabled=!0}[r0](){this._headerCache=new Map,this._codecUpdateData=new WeakMap,this._codecHeaderSent=!1,this._codecShouldUpdate=!1,this._bitrate=null,this._isEnabled=!1}[Ge](t,s){if(this._onCodecUpdate){this._bitrate!==t&&(this._bitrate=t,this._codecShouldUpdate=!0);const n=this._codecUpdateData.get(this._headerCache.get(this._currentHeader));this._codecShouldUpdate&&n&&this._onCodecUpdate({bitrate:t,...n},s),this._codecShouldUpdate=!1}}[$](t){const s=this._headerCache.get(t);return s&&this._updateCurrentHeader(t),s}[F0](t,s,n){this._isEnabled&&(this._codecHeaderSent||(this._onCodecHeader({...s}),this._codecHeaderSent=!0),this._updateCurrentHeader(t),this._headerCache.set(t,s),this._codecUpdateData.set(s,n))}_updateCurrentHeader(t){this._onCodecUpdate&&t!==this._currentHeader&&(this._codecShouldUpdate=!0,this._currentHeader=t)}}const D=new WeakMap,K=new WeakMap;class v0{constructor(t,s){this._codecParser=t,this._headerCache=s}*[we](){let t;do{if(t=yield*this.Frame[c0](this._codecParser,this._headerCache,0),t)return t;this._codecParser[G](1)}while(!0)}*[Ft](t){let s=yield*this[we]();const n=K.get(s)[o];if(t||this._codecParser._flushing||(yield*this.Header[$](this._codecParser,this._headerCache,n)))return this._headerCache[w0](),this._codecParser[G](n),this._codecParser[wt](s),s;this._codecParser[x0](`Missing ${o0} at ${n} bytes from current position.`,`Dropping current ${o0} and trying again.`),this._headerCache[r0](),this._codecParser[G](1)}}class Je{constructor(t,s){K.set(this,{[n0]:t}),this[v]=s}}class z0 extends Je{static*[c0](t,s,n,e,i){const c=yield*t[$](n,e,i);if(c){const a=D.get(c)[Z],f=D.get(c)[M],_=(yield*n[x](a,i))[y](0,a);return new s(c,_,f)}else return null}constructor(t,s,n){super(t,s),this[n0]=t,this[M]=n,this[d0]=n/t[w]*1e3,this[A0]=null,this[ht]=null,this[ne]=null,this[ut]=null,K.get(this)[o]=s[o]}}const Zt="unsynchronizationFlag",Kt="extendedHeaderFlag",Xt="experimentalFlag",Qt="footerPresent";class me{static*getID3v2Header(t,s,n){const i={};let c=yield*t[x](3,n);if(c[0]!==73||c[1]!==68||c[2]!==51||(c=yield*t[x](10,n),i[U0]=`id3v2.${c[3]}.${c[4]}`,c[5]&15)||(i[Zt]=!!(c[5]&128),i[Kt]=!!(c[5]&64),i[Xt]=!!(c[5]&32),i[Qt]=!!(c[5]&16),c[6]&128||c[7]&128||c[8]&128||c[9]&128))return null;const a=c[6]<<21|c[7]<<14|c[8]<<7|c[9];return i[o]=10+a,new me(i)}constructor(t){this[U0]=t[U0],this[Zt]=t[Zt],this[Kt]=t[Kt],this[Xt]=t[Xt],this[Qt]=t[Qt],this[o]=t[o]}}class V0{constructor(t){D.set(this,t),this[j]=t[j],this[A]=null,this[u]=t[u],this[J]=t[J],this[w]=t[w]}}const Ze={0:[B0,B0,B0,B0,B0],16:[32,32,32,32,8],240:[U,U,U,U,U]},J0=(r,t,s)=>8*((r+s)%t+t)*(1<<(r+s)/t)-8*t*(t/8|0);for(let r=2;r<15;r++)Ze[r<<4]=[r*32,J0(r,4,0),J0(r,4,-1),J0(r,8,4),J0(r,8,0)];const bs=0,ps=1,ds=2,fs=3,ke=4,Z0="bands ",K0=" to 31",ve={0:Z0+4+K0,16:Z0+8+K0,32:Z0+12+K0,48:Z0+16+K0},Y="bitrateIndex",N0="v2",bt="v1",X0="Intensity stereo ",Q0=", MS stereo ",Y0="on",tt="off",_s={0:X0+tt+Q0+tt,16:X0+Y0+Q0+tt,32:X0+tt+Q0+Y0,48:X0+Y0+Q0+Y0},Yt={0:{[h]:m},2:{[h]:"Layer III",[E]:1,[t0]:_s,[bt]:{[Y]:ds,[M]:1152},[N0]:{[Y]:ke,[M]:576}},4:{[h]:"Layer II",[E]:1,[t0]:ve,[M]:1152,[bt]:{[Y]:ps},[N0]:{[Y]:ke}},6:{[h]:"Layer I",[E]:4,[t0]:ve,[M]:384,[bt]:{[Y]:bs},[N0]:{[Y]:fs}}},te="MPEG Version ",Me="ISO/IEC ",ms={0:{[h]:`${te}2.5 (later extension of MPEG 2)`,[N]:N0,[w]:{0:De,4:Ne,8:ue,12:m}},8:{[h]:m},16:{[h]:`${te}2 (${Me}13818-3)`,[N]:N0,[w]:{0:le,4:ae,8:he,12:m}},24:{[h]:`${te}1 (${Me}11172-3)`,[N]:bt,[w]:{0:oe,4:mt,8:ce,12:m}},length:o},gs={0:We,1:fe},ys={0:fe,1:"50/15 ms",2:m,3:"CCIT J.17"},Be={0:{[u]:2,[h]:f0},64:{[u]:2,[h]:"joint "+f0},128:{[u]:2,[h]:"dual channel"},192:{[u]:1,[h]:O0}};class D0 extends V0{static*[$](t,s,n){const e={},i=yield*me.getID3v2Header(t,s,n);i&&(yield*t[x](i[o],n),t[G](i[o]));const c=yield*t[x](4,n),a=a0(c[y](0,4)),f=s[$](a);if(f)return new D0(f);if(c[0]!==255||c[1]<224)return null;const _=ms[c[1]&24];if(_[h]===m)return null;const P=c[1]&6;if(Yt[P][h]===m)return null;const L={...Yt[P],...Yt[P][_[N]]};if(e[y0]=_[h],e[N]=L[h],e[M]=L[M],e[C0]=gs[c[1]&1],e[o]=4,e[A]=Ze[c[2]&240][L[Y]],e[A]===U||(e[w]=_[w][c[2]&12],e[w]===m)||(e[E]=c[2]&2&&L[E],e[g0]=!!(c[2]&1),e[Z]=Math.floor(125*e[A]*e[M]/e[w]+e[E]),!e[Z]))return null;const l0=c[3]&192;if(e[J]=Be[l0][h],e[u]=Be[l0][u],e[t0]=L[t0][c[3]&48],e[At]=!!(c[3]&8),e[m0]=!!(c[3]&4),e[G0]=ys[c[3]&3],e[G0]===m)return null;e[j]=16;{const{length:q0,frameLength:h0,samples:Se,...$t}=e;s[F0](a,e,$t)}return new D0(e)}constructor(t){super(t),this[A]=t[A],this[G0]=t[G0],this[E]=t[E],this[At]=t[At],this[m0]=t[m0],this[g0]=t[g0],this[N]=t[N],this[t0]=t[t0],this[y0]=t[y0],this[C0]=t[C0]}}class ge extends z0{static*[c0](t,s,n){return yield*super[c0](D0,ge,t,s,n)}constructor(t,s,n){super(t,s,n)}}class Cs extends v0{constructor(t,s,n){super(t,s),this.Frame=ge,this.Header=D0,n(this[k])}get[k](){return Te}*[E0](){return yield*this[Ft]()}}const Ss={0:"MPEG-4",8:"MPEG-2"},xs={0:"valid",2:U,4:U,6:U},ws={0:We,1:fe},Fs={0:"AAC Main",64:"AAC LC (Low Complexity)",128:"AAC SSR (Scalable Sample Rate)",192:"AAC LTP (Long Term Prediction)"},ks={0:Ue,4:Ae,8:ss,12:mt,16:oe,20:ce,24:ae,28:le,32:he,36:Ne,40:De,44:ue,48:ns,52:m,56:m,60:"frequency is written explicitly"},$e={0:{[u]:0,[h]:"Defined in AOT Specific Config"},64:{[u]:1,[h]:O0},128:{[u]:2,[h]:F(2,l[0][0])},192:{[u]:3,[h]:F(3,l[1][3])},256:{[u]:4,[h]:F(4,l[1][3],l[3][4])},320:{[u]:5,[h]:F(5,l[1][3],l[3][0])},384:{[u]:6,[h]:F(6,l[1][3],l[3][0],q)},448:{[u]:8,[h]:F(8,l[1][3],l[2][0],l[3][0],q)}};class Mt extends V0{static*[$](t,s,n){const e={},i=yield*t[x](7,n),c=a0([i[0],i[1],i[2],i[3]&252|i[6]&3]),a=s[$](c);if(a)Object.assign(e,a);else{if(i[0]!==255||i[1]<240||(e[y0]=Ss[i[1]&8],e[N]=xs[i[1]&6],e[N]===U))return null;const _=i[1]&1;e[C0]=ws[_],e[o]=_?7:9,e[Et]=i[2]&192,e[z]=i[2]&60;const P=i[2]&2;if(e[Tt]=Fs[e[Et]],e[w]=ks[e[z]],e[w]===m)return null;e[g0]=!!P,e[W0]=(i[2]<<8|i[3])&448,e[J]=$e[e[W0]][h],e[u]=$e[e[W0]][u],e[m0]=!!(i[3]&32),e[Nt]=!!(i[3]&8),e[qt]=!!(i[3]&8),e[Gt]=!!(i[3]&4),e[j]=16,e[M]=1024,e[Rt]=i[6]&3;{const{length:L,channelModeBits:l0,profileBits:q0,sampleRateBits:h0,frameLength:Se,samples:$t,numberAACFrames:xe,...Ye}=e;s[F0](c,e,Ye)}}if(e[Z]=(i[3]<<11|i[4]<<3|i[5]>>5)&8191,!e[Z])return null;const f=(i[5]<<6|i[6]>>2)&2047;return e[It]=f===2047?"VBR":f,new Mt(e)}constructor(t){super(t),this[qt]=t[qt],this[Gt]=t[Gt],this[It]=t[It],this[Nt]=t[Nt],this[m0]=t[m0],this[g0]=t[g0],this[N]=t[N],this[o]=t[o],this[y0]=t[y0],this[Rt]=t[Rt],this[Tt]=t[Tt],this[C0]=t[C0]}get audioSpecificConfig(){const t=D.get(this),s=t[Et]+64<<5|t[z]<<5|t[W0]>>3,n=new R(2);return new vt(n[T0]).setUint16(0,s,!1),n}}class ye extends z0{static*[c0](t,s,n){return yield*super[c0](Mt,ye,t,s,n)}constructor(t,s,n){super(t,s,n)}}class vs extends v0{constructor(t,s,n){super(t,s),this.Frame=ye,this.Header=Mt,n(this[k])}get[k](){return"aac"}*[E0](){return yield*this[Ft]()}}class s0 extends z0{static _getFrameFooterCrc16(t){return(t[t[o]-2]<<8)+t[t[o]-1]}static[je](t){const s=s0._getFrameFooterCrc16(t),n=as(t[y](0,-2));return s===n}constructor(t,s,n){s[Ve]=n,s[Re]=s0._getFrameFooterCrc16(t),super(s,t,D.get(s)[M])}}const Ke="get from STREAMINFO metadata block",Ms={0:"Fixed",1:"Variable"},Xe={0:m,16:192};for(let r=2;r<16;r++)Xe[r<<4]=r<6?576*2**(r-2):2**r;const Bs={0:Ke,1:Ae,2:es,3:ts,4:ue,5:he,6:le,7:ae,8:ce,9:oe,10:mt,11:Ue,15:U},$s={0:{[u]:1,[h]:O0},16:{[u]:2,[h]:F(2,l[0][0])},32:{[u]:3,[h]:F(3,l[0][1])},48:{[u]:4,[h]:F(4,l[1][0],l[3][0])},64:{[u]:5,[h]:F(5,l[1][1],l[3][0])},80:{[u]:6,[h]:F(6,l[1][1],q,l[3][0])},96:{[u]:7,[h]:F(7,l[1][1],q,l[3][4],l[2][0])},112:{[u]:8,[h]:F(8,l[1][1],q,l[3][0],l[2][0])},128:{[u]:2,[h]:`${f0} (left, diff)`},144:{[u]:2,[h]:`${f0} (diff, right)`},160:{[u]:2,[h]:`${f0} (avg, diff)`},176:m,192:m,208:m,224:m,240:m},Ps={0:Ke,2:8,4:12,6:m,8:16,10:20,12:24,14:m};class V extends V0{static _decodeUTF8Int(t){if(t[0]>254)return null;if(t[0]<128)return{value:t[0],length:1};let s=1;for(let c=64;c&t[0];c>>=1)s++;let n=s-1,e=0,i=0;for(;n>0;i+=6,n--){if((t[n]&192)!==128)return null;e|=(t[n]&63)<<i}return e|=(t[n]&127>>s)<<i,{value:e,length:s}}static[k0](t,s){const n={[x]:function*(){return t}};return V[$](n,s,0).next().value}static*[$](t,s,n){let e=yield*t[x](6,n);if(e[0]!==255||!(e[1]===248||e[1]===249))return null;const i={},c=a0(e[y](0,4)),a=s[$](c);if(a)Object.assign(i,a);else{if(i[Vt]=e[1]&1,i[zt]=Ms[i[Vt]],i[j0]=e[2]&240,i[z]=e[2]&15,i[X]=Xe[i[j0]],i[X]===m||(i[w]=Bs[i[z]],i[w]===U)||e[3]&1)return null;const _=$s[e[3]&240];if(_===m||(i[u]=_[u],i[J]=_[h],i[j]=Ps[e[3]&14],i[j]===m))return null}i[o]=5,e=yield*t[x](i[o]+8,n);const f=V._decodeUTF8Int(e[y](4));if(!f||(i[Vt]?i[Wt]=f.value:i[A0]=f.value,i[o]+=f[o],i[j0]===96?(e[o]<i[o]&&(e=yield*t[x](i[o],n)),i[X]=e[i[o]-1]+1,i[o]+=1):i[j0]===112&&(e[o]<i[o]&&(e=yield*t[x](i[o],n)),i[X]=(e[i[o]-1]<<8)+e[i[o]]+1,i[o]+=2),i[M]=i[X],i[z]===12?(e[o]<i[o]&&(e=yield*t[x](i[o],n)),i[w]=e[i[o]-1]*1e3,i[o]+=1):i[z]===13?(e[o]<i[o]&&(e=yield*t[x](i[o],n)),i[w]=(e[i[o]-1]<<8)+e[i[o]],i[o]+=2):i[z]===14&&(e[o]<i[o]&&(e=yield*t[x](i[o],n)),i[w]=((e[i[o]-1]<<8)+e[i[o]])*10,i[o]+=2),e[o]<i[o]&&(e=yield*t[x](i[o],n)),i[pt]=e[i[o]-1],i[pt]!==cs(e[y](0,i[o]-1))))return null;if(!a){const{blockingStrategyBits:_,frameNumber:P,sampleNumber:L,samples:l0,sampleRateBits:q0,blockSizeBits:h0,crc:Se,length:$t,...xe}=i;s[F0](c,i,xe)}return new V(i)}constructor(t){super(t),this[Re]=null,this[zt]=t[zt],this[X]=t[X],this[A0]=t[A0],this[Wt]=t[Wt],this[Ve]=null}}const Hs=2,Ls=512*1024;class Qe extends v0{constructor(t,s,n){super(t,s),this.Frame=s0,this.Header=V,n(this[k])}get[k](){return"flac"}*_getNextFrameSyncOffset(t){const s=yield*this._codecParser[x](2,0),n=s[o]-2;for(;t<n;){if(s[t]===255){const i=s[t+1];if(i===248||i===249)break;i!==255&&t++}t++}return t}*[E0](){do{const t=yield*V[$](this._codecParser,this._headerCache,0);if(t){let s=D.get(t)[o]+Hs;for(;s<=Ls;){if(this._codecParser._flushing||(yield*V[$](this._codecParser,this._headerCache,s))){let n=yield*this._codecParser[x](s);if(this._codecParser._flushing||(n=n[y](0,s)),s0[je](n)){const e=new s0(n,t);return this._headerCache[w0](),this._codecParser[G](s),this._codecParser[wt](e),e}}s=yield*this._getNextFrameSyncOffset(s+1)}this._codecParser[x0](`Unable to sync FLAC frame after searching ${s} bytes.`),this._codecParser[G](s)}else this._codecParser[G](yield*this._getNextFrameSyncOffset(1))}while(!0)}[kt](t){return t[H]===0?(this._headerCache[w0](),this._streamInfo=t[v][y](13)):t[H]===1||(t[W]=K.get(t)[e0].map(s=>{const n=V[k0](s,this._headerCache);if(n)return new s0(s,n,this._streamInfo);this._codecParser[x0]("Failed to parse Ogg FLAC frame","Skipping invalid FLAC frame")}).filter(s=>!!s)),t}}class Bt{static*[$](t,s,n){const e={};let i=yield*t[x](28,n);if(i[0]!==79||i[1]!==103||i[2]!==103||i[3]!==83||(e[rs]=i[4],i[5]&248))return null;e[i0]=!!(i[5]&4),e[I0]=!!(i[5]&2),e[L0]=!!(i[5]&1);const a=new vt(R.from(i[y](0,28))[T0]);try{e[_0]=a.getBigInt64(6,!0)}catch{}e[S0]=a.getInt32(14,!0),e[H]=a.getInt32(18,!0),e[at]=a.getInt32(22,!0);const f=i[26];e[o]=f+27,i=yield*t[x](e[o],n),e[Z]=0,e[H0]=[],e[dt]=R.from(i[y](27,e[o]));for(let _=0,P=0;_<f;_++){const L=e[dt][_];e[Z]+=L,P+=L,(L!==255||_===f-1)&&(e[H0].push(P),P=0)}return new Bt(e)}constructor(t){D.set(this,t),this[_0]=t[_0],this[L0]=t[L0],this[I0]=t[I0],this[i0]=t[i0],this[H0]=t[H0],this[H]=t[H],this[at]=t[at],this[S0]=t[S0]}}class Ce extends Je{static*[c0](t,s,n){const e=yield*Bt[$](t,s,n);if(e){const i=D.get(e)[Z],c=D.get(e)[o],a=c+i,f=(yield*t[x](a,0))[y](0,a),_=f[y](c,a);return new Ce(e,_,f)}else return null}constructor(t,s,n){super(t,s),K.get(this)[o]=n[o],this[W]=[],this[is]=n,this[_0]=t[_0],this[Oe]=t[at],this[d0]=0,this[L0]=t[L0],this[I0]=t[I0],this[i0]=t[i0],this[H]=t[H],this[M]=0,this[S0]=t[S0]}}class Pe extends z0{constructor(t,s){super(s,t,s[p]*s[p0]/1e3*s[w])}}const He={0:se.slice(0,2),1:se},I="SILK-only",B="CELT-only",et="Hybrid",O="narrowband",st="medium-band",T="wideband",u0="super-wideband",b0="fullband",Is={0:{[b]:I,[d]:O,[p]:10},8:{[b]:I,[d]:O,[p]:20},16:{[b]:I,[d]:O,[p]:40},24:{[b]:I,[d]:O,[p]:60},32:{[b]:I,[d]:st,[p]:10},40:{[b]:I,[d]:st,[p]:20},48:{[b]:I,[d]:st,[p]:40},56:{[b]:I,[d]:st,[p]:60},64:{[b]:I,[d]:T,[p]:10},72:{[b]:I,[d]:T,[p]:20},80:{[b]:I,[d]:T,[p]:40},88:{[b]:I,[d]:T,[p]:60},96:{[b]:et,[d]:u0,[p]:10},104:{[b]:et,[d]:u0,[p]:20},112:{[b]:et,[d]:b0,[p]:10},120:{[b]:et,[d]:b0,[p]:20},128:{[b]:B,[d]:O,[p]:2.5},136:{[b]:B,[d]:O,[p]:5},144:{[b]:B,[d]:O,[p]:10},152:{[b]:B,[d]:O,[p]:20},160:{[b]:B,[d]:T,[p]:2.5},168:{[b]:B,[d]:T,[p]:5},176:{[b]:B,[d]:T,[p]:10},184:{[b]:B,[d]:T,[p]:20},192:{[b]:B,[d]:u0,[p]:2.5},200:{[b]:B,[d]:u0,[p]:5},208:{[b]:B,[d]:u0,[p]:10},216:{[b]:B,[d]:u0,[p]:20},224:{[b]:B,[d]:b0,[p]:2.5},232:{[b]:B,[d]:b0,[p]:5},240:{[b]:B,[d]:b0,[p]:10},248:{[b]:B,[d]:b0,[p]:20}};class R0 extends V0{static[k0](t,s,n){const e={};if(e[u]=t[9],e[Q]=t[18],e[o]=e[Q]!==0?21+e[u]:19,t[o]<e[o])throw new Error("Out of data while inside an Ogg Page");const i=s[0]&3,c=i===3?2:1,a=a0(t[y](0,e[o]))+a0(s[y](0,c)),f=n[$](a);if(f)return new R0(f);if(a.substr(0,8)!=="OpusHead"||t[8]!==1)return null;e[v]=R.from(t[y](0,e[o]));const _=new vt(e[v][T0]);if(e[j]=16,e[it]=_.getUint16(10,!0),e[jt]=_.getUint32(12,!0),e[w]=mt,e[Ot]=_.getInt16(16,!0),e[Q]in He&&(e[J]=He[e[Q]][e[u]-1],!e[J]))return null;e[Q]!==0&&(e[lt]=t[19],e[nt]=t[20],e[ct]=[...t[y](21,e[u]+21)]);const P=Is[248&s[0]];switch(e[b]=P[b],e[d]=P[d],e[p]=P[p],i){case 0:e[p0]=1;break;case 1:case 2:e[p0]=2;break;case 3:e[Dt]=!!(128&s[1]),e[Ut]=!!(64&s[1]),e[p0]=63&s[1];break;default:return null}{const{length:L,data:l0,channelMappingFamily:q0,...h0}=e;n[F0](a,e,h0)}return new R0(e)}constructor(t){super(t),this[v]=t[v],this[d]=t[d],this[Q]=t[Q],this[ct]=t[ct],this[nt]=t[nt],this[p0]=t[p0],this[p]=t[p],this[Ut]=t[Ut],this[jt]=t[jt],this[Dt]=t[Dt],this[b]=t[b],this[Ot]=t[Ot],this[it]=t[it],this[lt]=t[lt]}}class Us extends v0{constructor(t,s,n){super(t,s),this.Frame=Pe,this.Header=R0,n(this[k]),this._identificationHeader=null}get[k](){return"opus"}[kt](t){return t[H]===0?(this._headerCache[w0](),this._identificationHeader=t[v]):t[H]===1||(t[W]=K.get(t)[e0].map(s=>{const n=R0[k0](this._identificationHeader,s,this._headerCache);if(n)return new Pe(s,n);this._codecParser[qe]("Failed to parse Ogg Opus Header","Not a valid Ogg Opus file")})),t}}class Le extends z0{constructor(t,s,n){super(s,t,n)}}const re={};for(let r=0;r<8;r++)re[r+6]=2**(6+r);class _t extends V0{static[k0](t,s,n,e){if(t[o]<30)throw new Error("Out of data while inside an Ogg Page");const i=a0(t[y](0,30)),c=s[$](i);if(c)return new _t(c);const a={[o]:30};if(i.substr(0,7)!=="vorbis")return null;a[v]=R.from(t[y](0,30));const f=new vt(a[v][T0]);if(a[U0]=f.getUint32(7,!0),a[U0]!==0||(a[u]=t[11],a[J]=se[a[u]-1]||"application defined",a[w]=f.getUint32(12,!0),a[Pt]=f.getInt32(16,!0),a[Lt]=f.getInt32(20,!0),a[Ht]=f.getInt32(24,!0),a[P0]=re[(t[28]&240)>>4],a[$0]=re[t[28]&15],a[$0]>a[P0])||t[29]!==1)return null;a[j]=32,a[ot]=e,a[rt]=n;{const{length:_,data:P,version:L,vorbisSetup:l0,vorbisComments:q0,...h0}=a;s[F0](i,a,h0)}return new _t(a)}constructor(t){super(t),this[Pt]=t[Pt],this[Ht]=t[Ht],this[Lt]=t[Lt],this[$0]=t[$0],this[P0]=t[P0],this[v]=t[v],this[rt]=t[rt],this[ot]=t[ot]}}class As extends v0{constructor(t,s,n){super(t,s),this.Frame=Le,n(this[k]),this._identificationHeader=null,this._setupComplete=!1,this._prevBlockSize=null}get[k](){return gt}[kt](t){t[W]=[];for(const s of K.get(t)[e0])if(s[0]===1)this._headerCache[w0](),this._identificationHeader=t[v],this._setupComplete=!1;else if(s[0]===3)this._vorbisComments=s;else if(s[0]===5)this._vorbisSetup=s,this._mode=this._parseSetupHeader(s),this._setupComplete=!0;else if(this._setupComplete){const n=_t[k0](this._identificationHeader,this._headerCache,this._vorbisComments,this._vorbisSetup);n?t[W].push(new Le(s,n,this._getSamples(s,n))):this._codecParser[logError]("Failed to parse Ogg Vorbis Header","Not a valid Ogg Vorbis file")}return t}_getSamples(t,s){const e=this._mode.blockFlags[t[0]>>1&this._mode.mask]?s[P0]:s[$0],i=this._prevBlockSize===null?0:(this._prevBlockSize+e)/4;return this._prevBlockSize=e,i}_parseSetupHeader(t){const s=new hs(t),n={count:0,blockFlags:[]};for(;(s.read(1)&1)!==1;);let e;for(;n.count<64&&s.position>0;){ft(s.read(8));let i=0;for(;s.read(8)===0&&i++<3;);if(i===4)e=s.read(7),n.blockFlags.unshift(e&1),s.position+=6,n.count++;else{((ft(e)&126)>>1)+1!==n.count&&this._codecParser[x0]("vorbis derived mode count did not match actual mode count");break}}return n.mask=(1<<Math.log2(n.count))-1,n}}class Ns{constructor(t,s,n){this._codecParser=t,this._headerCache=s,this._onCodec=n,this._continuedPacket=new R,this._codec=null,this._isSupported=null}get[k](){return this._codec||""}_updateCodec(t,s){this._codec!==t&&(this._headerCache[r0](),this._parser=new s(this._codecParser,this._headerCache,this._onCodec),this._codec=t)}_checkCodecSupport({data:t}){const s=a0(t[y](0,8));switch(s){case"fishead\0":return!1;case"OpusHead":return this._updateCodec("opus",Us),!0;case(/^\x7fFLAC/.test(s)&&s):return this._updateCodec("flac",Qe),!0;case(/^\x01vorbis/.test(s)&&s):return this._updateCodec(gt,As),!0;default:return!1}}_checkPageSequenceNumber(t){t[H]!==this._pageSequenceNumber+1&&this._pageSequenceNumber>1&&t[H]>1&&this._codecParser[x0]("Unexpected gap in Ogg Page Sequence Number.",`Expected: ${this._pageSequenceNumber+1}, Got: ${t[H]}`),this._pageSequenceNumber=t[H]}_parsePage(t){this._isSupported===null&&(this._pageSequenceNumber=t[H],this._isSupported=this._checkCodecSupport(t)),this._checkPageSequenceNumber(t);const s=K.get(t),n=D.get(s[n0]);let e=0;if(s[e0]=n[H0].map(i=>t[v][y](e,e+=i)),this._continuedPacket[o]&&(s[e0][0]=ie(this._continuedPacket,s[e0][0]),this._continuedPacket=new R),n[dt][n[dt][o]-1]===255&&(this._continuedPacket=ie(this._continuedPacket,s[e0].pop())),this._isSupported){const i=this._parser[kt](t);return this._codecParser[wt](i),i}else return t}}class Ds extends v0{constructor(t,s,n){super(t,s),this._onCodec=n,this.Frame=Ce,this.Header=Bt,this._streams=new Map,this._currentSerialNumber=null}get[k](){const t=this._streams.get(this._currentSerialNumber);return t?t.codec:""}*[E0](){const t=yield*this[Ft](!0);this._currentSerialNumber=t[S0];let s=this._streams.get(this._currentSerialNumber);return s||(s=new Ns(this._codecParser,this._headerCache,this._onCodec),this._streams.set(this._currentSerialNumber,s)),t[i0]&&this._streams.delete(this._currentSerialNumber),s._parsePage(t)}}const ee=()=>{};class Rs{constructor(t,{onCodec:s,onCodecHeader:n,onCodecUpdate:e,enableLogging:i=!1,enableFrameCRC32:c=!0}={}){this._inputMimeType=t,this._onCodec=s||ee,this._onCodecHeader=n||ee,this._onCodecUpdate=e,this._enableLogging=i,this._crc32=c?ls:ee,this[r0]()}get[k](){return this._parser?this._parser[k]:""}[r0](){this._headerCache=new us(this._onCodecHeader,this._onCodecUpdate),this._generator=this._getGenerator(),this._generator.next()}*flush(){this._flushing=!0;for(let t=this._generator.next();t.value;t=this._generator.next())yield t.value;this._flushing=!1,this[r0]()}*parseChunk(t){for(let s=this._generator.next(t);s.value;s=this._generator.next())yield s.value}parseAll(t){return[...this.parseChunk(t),...this.flush()]}*_getGenerator(){if(this._inputMimeType.match(/aac/))this._parser=new vs(this,this._headerCache,this._onCodec);else if(this._inputMimeType.match(/mpeg/))this._parser=new Cs(this,this._headerCache,this._onCodec);else if(this._inputMimeType.match(/flac/))this._parser=new Qe(this,this._headerCache,this._onCodec);else if(this._inputMimeType.match(/ogg/))this._parser=new Ds(this,this._headerCache,this._onCodec);else throw new Error(`Unsupported Codec ${mimeType}`);for(this._frameNumber=0,this._currentReadPosition=0,this._totalBytesIn=0,this._totalBytesOut=0,this._totalSamples=0,this._sampleRate=void 0,this._rawData=new Uint8Array(0);;){const t=yield*this._parser[E0]();t&&(yield t)}}*[x](t=0,s=0){let n;for(;this._rawData[o]<=t+s;){if(n=yield,this._flushing)return this._rawData[y](s);n&&(this._totalBytesIn+=n[o],this._rawData=ie(this._rawData,n))}return this._rawData[y](s)}[G](t){this._currentReadPosition+=t,this._rawData=this._rawData[y](t)}[Jt](t){this._sampleRate=t[n0][w],t[n0][A]=t[d0]>0?Math.round(t[v][o]/t[d0])*8:0,t[A0]=this._frameNumber++,t[ht]=this._totalBytesOut,t[ne]=this._totalSamples,t[ut]=this._totalSamples/this._sampleRate*1e3,t[Oe]=this._crc32(t[v]),this._headerCache[Ge](t[n0][A],t[ut]),this._totalBytesOut+=t[v][o],this._totalSamples+=t[M]}[wt](t){t[W]?(t[W].forEach(s=>{t[d0]+=s[d0],t[M]+=s[M],this[Jt](s)}),t[ne]=this._totalSamples,t[ut]=this._totalSamples/this._sampleRate*1e3||0,t[ht]=this._totalBytesOut):this[Jt](t)}_log(t,s){if(this._enableLogging){const n=[`${k}:         ${this[k]}`,`inputMimeType: ${this._inputMimeType}`,`readPosition:  ${this._currentReadPosition}`,`totalBytesIn:  ${this._totalBytesIn}`,`${ht}: ${this._totalBytesOut}`],e=Math.max(...n.map(i=>i[o]));s.push(`--stats--${"-".repeat(e-9)}`,...n,"-".repeat(e)),t("codec-parser",s.reduce((i,c)=>i+`
  `+c,""))}}[x0](...t){this._log(console.warn,t)}[qe](...t){this._log(console.error,t)}}const Os=_0,Ts=W,Es=nt,zs=v,Vs=n0,qs=i0,Gs=it,js=rt,Ws=ot,Js=ct,Zs=u,Ks=M,Xs=lt;export{Rs as C,Ws as a,Os as b,Ts as c,zs as d,Zs as e,Xs as f,Es as g,Vs as h,qs as i,Js as j,Gs as p,Ks as s,js as v};
